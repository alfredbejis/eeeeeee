{"name":"interactive-bento-gallery","type":"registry:block","dependencies":["lucide-react","framer-motion"],"registryDependencies":[],"files":[{"path":"/components/blocks/interactive-bento-gallery.tsx","content":"\"use client\"\r\nimport React, { useEffect, useRef, useState } from 'react'\r\nimport { motion, AnimatePresence } from 'framer-motion'\r\nimport { X } from 'lucide-react';\r\n\r\n\r\n// MediaItemType defines the structure of a media item\r\ninterface MediaItemType {\r\n    id: number;\r\n    type: string;\r\n    title: string;\r\n    desc: string;\r\n    url: string;\r\n    span: string;\r\n}\r\n// MediaItem component renders either a video or image based on item.type\r\nconst MediaItem = ({ item, className, onClick }: { item: MediaItemType, className?: string, onClick?: () => void }) => {\r\n    const videoRef = useRef<HTMLVideoElement>(null); // Reference for video element\r\n    const [isInView, setIsInView] = useState(false); // To track if video is in the viewport\r\n    const [isBuffering, setIsBuffering] = useState(true);  // To track if video is buffering\r\n\r\n    // Intersection Observer to detect if video is in view and play/pause accordingly\r\n    useEffect(() => {\r\n        const options = {\r\n            root: null,\r\n            rootMargin: '50px',\r\n            threshold: 0.1\r\n        };\r\n\r\n        const observer = new IntersectionObserver((entries) => {\r\n            entries.forEach((entry) => {\r\n                setIsInView(entry.isIntersecting); // Set isInView to true if the video is in view\r\n            });\r\n        }, options);\r\n\r\n        if (videoRef.current) {\r\n            observer.observe(videoRef.current); // Start observing the video element\r\n        }\r\n\r\n        return () => {\r\n            if (videoRef.current) {\r\n                observer.unobserve(videoRef.current); // Clean up observer when component unmounts\r\n            }\r\n        };\r\n    }, []);\r\n    // Handle video play/pause based on whether the video is in view or not\r\n    useEffect(() => {\r\n        let mounted = true;\r\n\r\n        const handleVideoPlay = async () => {\r\n            if (!videoRef.current || !isInView || !mounted) return; // Don't play if video is not in view or component is unmounted\r\n\r\n            try {\r\n                if (videoRef.current.readyState >= 3) {\r\n                    setIsBuffering(false);\r\n                    await videoRef.current.play(); // Play the video if it's ready\r\n                } else {\r\n                    setIsBuffering(true);\r\n                    await new Promise((resolve) => {\r\n                        if (videoRef.current) {\r\n                            videoRef.current.oncanplay = resolve; // Wait until the video can start playing\r\n                        }\r\n                    });\r\n                    if (mounted) {\r\n                        setIsBuffering(false);\r\n                        await videoRef.current.play();\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                console.warn(\"Video playback failed:\", error);\r\n            }\r\n        };\r\n\r\n        if (isInView) {\r\n            handleVideoPlay();\r\n        } else if (videoRef.current) {\r\n            videoRef.current.pause();\r\n        }\r\n\r\n        return () => {\r\n            mounted = false;\r\n            if (videoRef.current) {\r\n                videoRef.current.pause();\r\n                videoRef.current.removeAttribute('src');\r\n                videoRef.current.load();\r\n            }\r\n        };\r\n    }, [isInView]);\r\n\r\n    // Render either a video or image based on item.type\r\n\r\n    if (item.type === 'video') {\r\n        return (\r\n            <div className={`${className} relative overflow-hidden`}>\r\n                <video\r\n                    ref={videoRef}\r\n                    className=\"w-full h-full object-cover\"\r\n                    onClick={onClick}\r\n                    playsInline\r\n                    muted\r\n                    loop\r\n                    preload=\"auto\"\r\n                    style={{\r\n                        opacity: isBuffering ? 0.8 : 1,\r\n                        transition: 'opacity 0.2s',\r\n                        transform: 'translateZ(0)',\r\n                        willChange: 'transform',\r\n                    }}\r\n                >\r\n                    <source src={item.url} type=\"video/mp4\" />\r\n                </video>\r\n                {isBuffering && (\r\n                    <div className=\"absolute inset-0 flex items-center justify-center bg-black/10\">\r\n                        <div className=\"w-6 h-6 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                    </div>\r\n                )}\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <img\r\n            src={item.url} // Image source URL\r\n            alt={item.title} // Alt text for the image\r\n            className={`${className} object-cover cursor-pointer`} // Style the image\r\n            onClick={onClick} // Trigger onClick when the image is clicked\r\n            loading=\"lazy\" // Lazy load the image for performance\r\n            decoding=\"async\" // Decode the image asynchronously\r\n        />\r\n    );\r\n};\r\n\r\n\r\n\r\n// GalleryModal component displays the selected media item in a modal\r\ninterface GalleryModalProps {\r\n    selectedItem: MediaItemType;\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    setSelectedItem: (item: MediaItemType | null) => void;\r\n    mediaItems: MediaItemType[]; // List of media items to display in the modal\r\n}\r\nconst GalleryModal = ({ selectedItem, isOpen, onClose, setSelectedItem, mediaItems }: GalleryModalProps) => {\r\n    const [dockPosition, setDockPosition] = useState({ x: 0, y: 0 });  // Track the position of the dockable panel\r\n\r\n    if (!isOpen) return null; // Return null if the modal is not open\r\n\r\n    return (\r\n        <>\r\n            {/* Main Modal */}\r\n            <motion.div\r\n                initial={{ scale: 0.98 }}\r\n                animate={{ scale: 1 }}\r\n                exit={{ scale: 0.98 }}\r\n                transition={{\r\n                    type: \"spring\",\r\n                    stiffness: 400,\r\n                    damping: 30\r\n                }}\r\n                className=\"fixed inset-0 w-full min-h-screen sm:h-[90vh] md:h-[600px] backdrop-blur-lg \r\n                          rounded-none sm:rounded-lg md:rounded-xl overflow-hidden z-10\"\r\n\r\n            >\r\n                {/* Main Content */}\r\n                <div className=\"h-full flex flex-col\">\r\n                    <div className=\"flex-1 p-2 sm:p-3 md:p-4 flex items-center justify-center bg-gray-50/50\">\r\n                        <AnimatePresence mode=\"wait\">\r\n                            <motion.div\r\n                                key={selectedItem.id}\r\n                                className=\"relative w-full aspect-[16/9] max-w-[95%] sm:max-w-[85%] md:max-w-3xl \r\n                                         h-auto max-h-[70vh] rounded-lg overflow-hidden shadow-md\"\r\n                                initial={{ y: 20, scale: 0.97 }}\r\n                                animate={{\r\n                                    y: 0,\r\n                                    scale: 1,\r\n                                    transition: {\r\n                                        type: \"spring\",\r\n                                        stiffness: 500,\r\n                                        damping: 30,\r\n                                        mass: 0.5\r\n                                    }\r\n                                }}\r\n                                exit={{\r\n                                    y: 20,\r\n                                    scale: 0.97,\r\n                                    transition: { duration: 0.15 }\r\n                                }}\r\n                                onClick={onClose}\r\n                            >\r\n                                <MediaItem item={selectedItem} className=\"w-full h-full object-contain bg-gray-900/20\" onClick={onClose} />\r\n                                <div className=\"absolute bottom-0 left-0 right-0 p-2 sm:p-3 md:p-4 \r\n                                              bg-gradient-to-t from-black/50 to-transparent\">\r\n                                    <h3 className=\"text-white text-base sm:text-lg md:text-xl font-semibold\">\r\n                                        {selectedItem.title}\r\n                                    </h3>\r\n                                    <p className=\"text-white/80 text-xs sm:text-sm mt-1\">\r\n                                        {selectedItem.desc}\r\n                                    </p>\r\n                                </div>\r\n                            </motion.div>\r\n                        </AnimatePresence>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Close Button */}\r\n                <motion.button\r\n                    className=\"absolute top-2 sm:top-2.5 md:top-3 right-2 sm:right-2.5 md:right-3 \r\n                              p-2 rounded-full bg-gray-200/80 text-gray-700 hover:bg-gray-300/80 \r\n                              text-xs sm:text-sm backdrop-blur-sm \"\r\n                    onClick={onClose}\r\n                    whileHover={{ scale: 1.1 }}\r\n                    whileTap={{ scale: 0.9 }}\r\n                >\r\n                    <X className='w-3 h-3' />\r\n                </motion.button>\r\n\r\n            </motion.div>\r\n\r\n            {/* Draggable Dock */}\r\n            <motion.div\r\n                drag\r\n                dragMomentum={false}\r\n                dragElastic={0.1}\r\n                initial={false}\r\n                animate={{ x: dockPosition.x, y: dockPosition.y }}\r\n                onDragEnd={(_, info) => {\r\n                    setDockPosition(prev => ({\r\n                        x: prev.x + info.offset.x,\r\n                        y: prev.y + info.offset.y\r\n                    }));\r\n                }}\r\n                className=\"fixed z-50 left-1/2 bottom-4 -translate-x-1/2 touch-none\"\r\n            >\r\n                <motion.div\r\n                    className=\"relative rounded-xl bg-sky-400/20 backdrop-blur-xl \r\n                             border border-blue-400/30 shadow-lg\r\n                             cursor-grab active:cursor-grabbing\"\r\n                >\r\n                    <div className=\"flex items-center -space-x-2 px-3 py-2\">\r\n                        {mediaItems.map((item, index) => (\r\n                            <motion.div\r\n                                key={item.id}\r\n                                onClick={(e) => {\r\n                                    e.stopPropagation();\r\n                                    setSelectedItem(item);\r\n                                }}\r\n                                style={{\r\n                                    zIndex: selectedItem.id === item.id ? 30 : mediaItems.length - index,\r\n                                }}\r\n                                className={`\r\n                                    relative group\r\n                                    w-8 h-8 sm:w-9 sm:h-9 md:w-10 md:h-10 flex-shrink-0 \r\n                                    rounded-lg overflow-hidden \r\n                                    cursor-pointer hover:z-20\r\n                                    ${selectedItem.id === item.id\r\n                                        ? 'ring-2 ring-white/70 shadow-lg'\r\n                                        : 'hover:ring-2 hover:ring-white/30'}\r\n                                `}\r\n                                initial={{ rotate: index % 2 === 0 ? -15 : 15 }}\r\n                                animate={{\r\n                                    scale: selectedItem.id === item.id ? 1.2 : 1,\r\n                                    rotate: selectedItem.id === item.id ? 0 : index % 2 === 0 ? -15 : 15,\r\n                                    y: selectedItem.id === item.id ? -8 : 0,\r\n                                }}\r\n                                whileHover={{\r\n                                    scale: 1.3,\r\n                                    rotate: 0,\r\n                                    y: -10,\r\n                                    transition: { type: \"spring\", stiffness: 400, damping: 25 }\r\n                                }}\r\n                            >\r\n                                <MediaItem item={item} className=\"w-full h-full\" onClick={() => setSelectedItem(item)} />\r\n                                <div className=\"absolute inset-0 bg-gradient-to-b from-transparent via-white/5 to-white/20\" />\r\n                                {selectedItem.id === item.id && (\r\n                                    <motion.div\r\n                                        layoutId=\"activeGlow\"\r\n                                        className=\"absolute -inset-2 bg-white/20 blur-xl\"\r\n                                        initial={{ opacity: 0 }}\r\n                                        animate={{ opacity: 1 }}\r\n                                        transition={{ duration: 0.2 }}\r\n                                    />\r\n                                )}\r\n                            </motion.div>\r\n                        ))}\r\n                    </div>\r\n                </motion.div>\r\n            </motion.div>\r\n        </>\r\n    );\r\n};\r\n\r\n\r\n\r\ninterface InteractiveBentoGalleryProps {\r\n    mediaItems: MediaItemType[]\r\n    title: string\r\n    description: string\r\n\r\n}\r\n\r\nconst InteractiveBentoGallery: React.FC<InteractiveBentoGalleryProps> = ({ mediaItems, title, description }) => {\r\n    const [selectedItem, setSelectedItem] = useState<MediaItemType | null>(null);\r\n    const [items, setItems] = useState(mediaItems);\r\n    const [isDragging, setIsDragging] = useState(false);\r\n\r\n    return (\r\n        <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\r\n            <div className=\"mb-8 text-center\">\r\n                <motion.h1\r\n                    className=\"text-2xl sm:text-3xl md:text-4xl font-bold bg-clip-text text-transparent \r\n                             bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900\r\n                             dark:from-white dark:via-gray-200 dark:to-white\"\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ duration: 0.5 }}\r\n                >\r\n                    {title}\r\n                </motion.h1>\r\n                <motion.p\r\n                    className=\"mt-2 text-sm sm:text-base text-gray-600 dark:text-gray-400\"\r\n                    initial={{ opacity: 0, y: 20 }}\r\n                    animate={{ opacity: 1, y: 0 }}\r\n                    transition={{ duration: 0.5, delay: 0.1 }}\r\n                >\r\n                    {description}\r\n                </motion.p>\r\n            </div>\r\n            <AnimatePresence mode=\"wait\">\r\n                {selectedItem ? (\r\n                    <GalleryModal\r\n                        selectedItem={selectedItem}\r\n                        isOpen={true}\r\n                        onClose={() => setSelectedItem(null)}\r\n                        setSelectedItem={setSelectedItem}\r\n                        mediaItems={items}\r\n                    />\r\n                ) : (\r\n                    <motion.div\r\n                        className=\"grid grid-cols-1 sm:grid-cols-3 md:grid-cols-4 gap-3 auto-rows-[60px]\"\r\n                        initial=\"hidden\"\r\n                        animate=\"visible\"\r\n                        exit=\"hidden\"\r\n                        variants={{\r\n                            hidden: { opacity: 0 },\r\n                            visible: {\r\n                                opacity: 1,\r\n                                transition: { staggerChildren: 0.1 }\r\n                            }\r\n                        }}\r\n                    >\r\n                        {items.map((item, index) => (\r\n                            <motion.div\r\n                                key={item.id}\r\n                                layoutId={`media-${item.id}`}\r\n                                className={`relative overflow-hidden rounded-xl cursor-move ${item.span}`}\r\n                                onClick={() => !isDragging && setSelectedItem(item)}\r\n                                variants={{\r\n                                    hidden: { y: 50, scale: 0.9, opacity: 0 },\r\n                                    visible: {\r\n                                        y: 0,\r\n                                        scale: 1,\r\n                                        opacity: 1,\r\n                                        transition: {\r\n                                            type: \"spring\",\r\n                                            stiffness: 350,\r\n                                            damping: 25,\r\n                                            delay: index * 0.05\r\n                                        }\r\n                                    }\r\n                                }}\r\n                                whileHover={{ scale: 1.02 }}\r\n                                drag\r\n                                dragConstraints={{ left: 0, right: 0, top: 0, bottom: 0 }}\r\n                                dragElastic={1}\r\n                                onDragStart={() => setIsDragging(true)}\r\n                                onDragEnd={(e, info) => {\r\n                                    setIsDragging(false);\r\n                                    const moveDistance = info.offset.x + info.offset.y;\r\n                                    if (Math.abs(moveDistance) > 50) {\r\n                                        const newItems = [...items];\r\n                                        const draggedItem = newItems[index];\r\n                                        const targetIndex = moveDistance > 0 ?\r\n                                            Math.min(index + 1, items.length - 1) :\r\n                                            Math.max(index - 1, 0);\r\n                                        newItems.splice(index, 1);\r\n                                        newItems.splice(targetIndex, 0, draggedItem);\r\n                                        setItems(newItems);\r\n                                    }\r\n                                }}\r\n                            >\r\n                                <MediaItem\r\n                                    item={item}\r\n                                    className=\"absolute inset-0 w-full h-full\"\r\n                                    onClick={() => !isDragging && setSelectedItem(item)}\r\n                                />\r\n                                <motion.div\r\n                                    className=\"absolute inset-0 flex flex-col justify-end p-2 sm:p-3 md:p-4\"\r\n                                    initial={{ opacity: 0 }}\r\n                                    whileHover={{ opacity: 1 }}\r\n                                    transition={{ duration: 0.2 }}\r\n                                >\r\n                                    <div className=\"absolute inset-0 flex flex-col justify-end p-2 sm:p-3 md:p-4\">\r\n                                        <div className=\"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent\" />\r\n                                        <h3 className=\"relative text-white text-xs sm:text-sm md:text-base font-medium line-clamp-1\">\r\n                                            {item.title}\r\n                                        </h3>\r\n                                        <p className=\"relative text-white/70 text-[10px] sm:text-xs md:text-sm mt-0.5 line-clamp-2\">\r\n                                            {item.desc}\r\n                                        </p>\r\n                                    </div>\r\n                                </motion.div>\r\n                            </motion.div>\r\n                        ))}\r\n                    </motion.div>\r\n                )}\r\n            </AnimatePresence>\r\n        </div>\r\n    );\r\n};\r\n\r\n\r\nexport default InteractiveBentoGallery","type":"registry:block","target":""}],"tailwind":{"config":{}}}
